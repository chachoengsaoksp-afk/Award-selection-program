<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Prompt', sans-serif; background: #fff7f2; color: #1f2937; }
    .glass { background: rgba(255,255,255,0.9); border: 1px solid rgba(249,115,22,0.08); box-shadow: 0 6px 18px rgba(0,0,0,0.06); }
    .tab-active { background: linear-gradient(90deg,#fb923c,#fb6b2a); color: white; }
    .podium-1 { background: linear-gradient(180deg,#fff3e0,#ffd54f); }
    .podium-2 { background: linear-gradient(180deg,#f5f5f5,#cfcfcf); }
    .podium-3 { background: linear-gradient(180deg,#fff0e6,#e0a96a); }
    .orange-txt { color: #fb6b2a; font-weight:700; }
    @media (max-width:640px) {
      .podium-grid { flex-direction: column; gap: 12px; }
    }
  </style>
</head>
<body class="p-6">

<div id="loginBox" class="max-w-md mx-auto mt-8 glass rounded-xl p-6">
  <h2 class="text-2xl font-bold mb-4 text-center orange-txt">üéì ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£</h2>
  <input id="user" placeholder="Username" class="w-full p-3 rounded-md border mb-3" />
  <input id="pass" type="password" placeholder="Password" class="w-full p-3 rounded-md border mb-4" />
  <button onclick="login()" class="w-full bg-gradient-to-r from-orange-400 to-orange-600 text-white font-semibold p-3 rounded-md">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<div id="mainBox" class="hidden max-w-7xl mx-auto space-y-6">

  <div class="glass rounded-xl p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-bold orange-txt">Dashboard ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h1>
      <p class="text-sm text-gray-600">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</p>
    </div>
    <div class="flex gap-2">
      <button onclick="downloadPDF()" class="px-3 py-2 rounded-md border bg-white text-orange-600">üìÑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF</button>
      <button id="btnShowAnn" onclick="openAnnouncementPanel()" class="px-3 py-2 rounded-md bg-orange-500 text-white">üéâ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ú‡∏•</button>
      <button onclick="logout()" class="px-3 py-2 rounded-md border bg-white">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </div>

  <div class="grid md:grid-cols-2 gap-6">

    <div class="glass rounded-xl p-6">
      <h3 class="font-semibold mb-3 orange-txt">üìù ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
      <label class="text-sm text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
      <select id="candidate" class="w-full p-3 rounded-md border my-3" onchange="showInfo()"></select>

      <div id="infoBox" class="hidden bg-orange-50 p-3 rounded-md mb-3">
        <p><b>‡∏ä‡∏∑‡πà‡∏≠:</b> <span id="infoName"></span></p>
        <p><b>‡∏ú‡∏•‡∏á‡∏≤‡∏ô:</b> <span id="infoWork"></span></p>
        <p><b>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</b> <span id="infoType"></span></p>
      </div>

      <input id="score" type="number" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô" class="w-full p-3 rounded-md border mb-3" />
      <button onclick="saveScore()" class="w-full bg-gradient-to-r from-orange-400 to-orange-600 text-white p-3 rounded-md font-semibold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
    </div>

    <div class="glass rounded-xl p-6">
      <div class="flex items-center justify-between mb-3">
        <h3 class="font-semibold orange-txt">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö (‡∏£‡∏ß‡∏°)</h3>
        <div class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: <span id="totalCount">0</span></div>
      </div>
      <div class="overflow-auto max-h-96">
        <table class="w-full text-left bg-white rounded-md overflow-hidden">
          <thead class="bg-orange-500 text-white">
            <tr>
              <th class="p-3">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th class="text-right">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th><th class="text-right">‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£</th><th class="text-center">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th><th class="text-center">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</th>
            </tr>
          </thead>
          <tbody id="rankBody" class="divide-y"></tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<div id="announcementPanel" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
  <div class="w-full max-w-6xl bg-white rounded-xl shadow-2xl overflow-hidden">
    <div class="flex items-center justify-between p-4 border-b">
      <div>
        <h2 class="text-xl font-bold orange-txt">üé§ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ú‡∏• ‚Äî ‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</h2>
        <p class="text-sm text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ó‡πá‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</p>
      </div>
      <div class="flex gap-2">
        <button onclick="closeAnnouncementPanel()" class="px-3 py-2 rounded-md border">‡∏õ‡∏¥‡∏î</button>
        <button onclick="downloadPDF()" class="px-3 py-2 rounded-md bg-orange-500 text-white">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF</button>
      </div>
    </div>

    <div class="p-4">
      <div id="tabsHeader" class="flex gap-2 overflow-x-auto pb-4"></div>
      <div id="tabsContent" class="mt-2"></div>
    </div>
  </div>
</div>

<script>
function escapeHtml(s){ if(s===null||s===undefined) return ""; return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"); }

let currentUser=""; let candidates=[]; let rankingData=[];

function login(){ const u=(document.getElementById('user').value||"").toString().trim(); const p=(document.getElementById('pass').value||"").toString().trim(); if(!u||!p) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å username ‡πÅ‡∏•‡∏∞ password"); google.script.run.withSuccessHandler(function(res){ if(res && res.success){ currentUser=res.name; document.getElementById('loginBox').classList.add('hidden'); document.getElementById('mainBox').classList.remove('hidden'); loadCandidates(); loadRanking(); } else { alert(res && res.message ? res.message : "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); } }).checkLogin(u,p); }

function logout(){ location.reload(); }

function loadCandidates(){ google.script.run.withSuccessHandler(function(data){ candidates=data||[]; const sel=document.getElementById('candidate'); sel.innerHTML="<option value=''>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ --</option>"; for(let i=0;i<candidates.length;i++){ const c=candidates[i]; const txt=(c.name||"") + (c.type?(" ‚Äî "+c.type):""); const opt=document.createElement('option'); opt.value=i; opt.innerText=txt; sel.appendChild(opt); } }).getCandidates(); }

function showInfo(){ const idx=document.getElementById('candidate').value; if(idx===""){ document.getElementById('infoBox').classList.add('hidden'); return; } const c=candidates[Number(idx)]; document.getElementById('infoBox').classList.remove('hidden'); document.getElementById('infoName').innerText=c.name||""; document.getElementById('infoWork').innerText=c.work||""; document.getElementById('infoType').innerText=c.type||""; }

function saveScore(){ const idx=document.getElementById('candidate').value; const score=document.getElementById('score').value; if(idx===""||score==="") return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô"); const payload={ judge: currentUser || "‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£", name: candidates[idx].name, work: candidates[idx].work, type: candidates[idx].type, score: Number(score) }; google.script.run.withSuccessHandler(function(res){ alert(res); document.getElementById('score').value=""; loadRanking(); }).submitScore(payload); }

function loadRanking(){ google.script.run.withSuccessHandler(function(data){ rankingData = data || []; renderMainRankTable(rankingData); document.getElementById('totalCount').innerText = rankingData.length; }).getFullRanking(); }

function renderMainRankTable(data){ const tbody=document.getElementById('rankBody'); tbody.innerHTML=""; if(!data||data.length===0){ const tr=document.createElement('tr'); const td=document.createElement('td'); td.colSpan=6; td.className="p-4 text-center text-gray-600"; td.innerText="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"; tr.appendChild(td); tbody.appendChild(tr); return; } for(let i=0;i<data.length;i++){ const r=data[i]; const tr=document.createElement('tr'); tr.className="border-b"; const tdType=document.createElement('td'); tdType.className="p-3"; tdType.innerText = escapeHtml(r[0]); tr.appendChild(tdType); const tdName=document.createElement('td'); tdName.className="p-3"; tdName.innerText = escapeHtml(r[1]); tr.appendChild(tdName); const tdAvg=document.createElement('td'); tdAvg.className="p-3 text-right"; tdAvg.innerText = (r[2]===""? "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô": r[2]); tr.appendChild(tdAvg); const tdCount=document.createElement('td'); tdCount.className="p-3 text-right"; tdCount.innerText = (r[3]===""? "": r[3]); tr.appendChild(tdCount); const tdRank=document.createElement('td'); tdRank.className="p-3 text-center font-bold"; tdRank.innerText = (r[4]===""? "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô": r[4]); tr.appendChild(tdRank); const tdMedal=document.createElement('td'); tdMedal.className="p-3 text-center"; tdMedal.innerText = (r[5]||''); tr.appendChild(tdMedal); tbody.appendChild(tr); } }

function downloadPDF(){ google.script.run.withSuccessHandler(function(url){ if(url) window.open(url,'_blank'); else alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡πÑ‡∏î‡πâ'); }).exportPDF(); }

function openAnnouncementPanel(){ google.script.run.withSuccessHandler(function(data){ rankingData = data || []; if(rankingData.length === 0){ alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö'); return; } buildAnnouncementTabs(rankingData); document.getElementById('announcementPanel').classList.remove('hidden'); window.scrollTo({top:0,behavior:'smooth'}); }).getFullRanking(); }

function closeAnnouncementPanel(){ document.getElementById('announcementPanel').classList.add('hidden'); document.getElementById('tabsHeader').innerHTML=""; document.getElementById('tabsContent').innerHTML=""; document.getElementById('btnShowAnn').focus(); }

function buildAnnouncementTabs(data){ const grouped={}; for(let i=0;i<data.length;i++){ const row=data[i]; const type=row[0]||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"; if(!grouped[type]) grouped[type]=[]; grouped[type].push(row); } const types=Object.keys(grouped); types.forEach(function(t){ grouped[t].sort(function(a,b){ return (parseFloat(b[2])||-1) - (parseFloat(a[2])||-1); }); }); const header=document.getElementById('tabsHeader'); const content=document.getElementById('tabsContent'); header.innerHTML=""; content.innerHTML=""; types.forEach(function(type,idx){ const btn=document.createElement('button'); btn.type='button'; btn.className='px-4 py-2 rounded-full border text-sm'; btn.innerText=type+" ("+grouped[type].length+")"; btn.dataset.idx=idx; btn.onclick=function(){ activateTab(idx); }; header.appendChild(btn); const pane=document.createElement('div'); pane.id='pane-'+idx; pane.className='tab-pane hidden mt-4'; const podiumDiv=document.createElement('div'); podiumDiv.className='flex podium-grid gap-4 items-end justify-center mb-6'; const top=grouped[type].slice(0,3); const col2=document.createElement('div'); col2.className='w-full md:w-1/3 text-center'; if(top[1]){ const card=document.createElement('div'); card.className='p-4 rounded-md podium-2'; const rank=document.createElement('div'); rank.className='text-sm'; rank.innerText='2'; const name=document.createElement('div'); name.className='text-lg font-bold'; name.innerText=top[1][1]; const score=document.createElement('div'); score.className='text-sm'; score.innerText=top[1][2]===''? "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô": top[1][2] + ' ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô'; card.appendChild(rank); card.appendChild(name); card.appendChild(score); col2.appendChild(card); } podiumDiv.appendChild(col2); const col1=document.createElement('div'); col1.className='w-full md:w-1/3 text-center'; if(top[0]){ const card=document.createElement('div'); card.className='p-6 rounded-md podium-1'; const rank=document.createElement('div'); rank.className='text-sm'; rank.innerText='1'; const name=document.createElement('div'); name.className='text-2xl font-bold'; name.innerText=top[0][1]; const score=document.createElement('div'); score.className='text-sm'; score.innerText=top[0][2]===''? "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô": top[0][2] + ' ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô'; card.appendChild(rank); card.appendChild(name); card.appendChild(score); col1.appendChild(card); } podiumDiv.appendChild(col1); const col3=document.createElement('div'); col3.className='w-full md:w-1/3 text-center'; if(top[2]){ const card=document.createElement('div'); card.className='p-4 rounded-md podium-3'; const rank=document.createElement('div'); rank.className='text-sm'; rank.innerText='3'; const name=document.createElement('div'); name.className='text-lg font-bold'; name.innerText=top[2][1]; const score=document.createElement('div'); score.className='text-sm'; score.innerText=top[2][2]===''? "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô": top[2][2] + ' ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô'; card.appendChild(rank); card.appendChild(name); card.appendChild(score); col3.appendChild(card); } podiumDiv.appendChild(col3); pane.appendChild(podiumDiv); const wrap=document.createElement('div'); wrap.className='overflow-auto max-h-96 bg-white rounded-md p-3'; const table=document.createElement('table'); table.className='w-full text-left'; const thead=document.createElement('thead'); thead.innerHTML="<tr class='bg-orange-500 text-white'><th class='p-2 w-20'>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th class='p-2'>‡∏ä‡∏∑‡πà‡∏≠</th><th class='p-2 text-right w-36'>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th><th class='p-2 text-right w-36'>‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£</th><th class='p-2 text-center w-28'>‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</th></tr>"; table.appendChild(thead); const tbody=document.createElement('tbody'); grouped[type].forEach(function(r){ const tr=document.createElement('tr'); tr.className='border-t'; const tdRank=document.createElement('td'); tdRank.className='p-2'; tdRank.innerText = (r[4]===''? "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô": r[4]); const tdName=document.createElement('td'); tdName.className='p-2'; tdName.innerText=r[1]; const tdAvg=document.createElement('td'); tdAvg.className='p-2 text-right'; tdAvg.innerText = (r[2]===''? "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô": r[2]); const tdCount=document.createElement('td'); tdCount.className='p-2 text-right'; tdCount.innerText = (r[3]===''? "": r[3]); const tdMedal=document.createElement('td'); tdMedal.className='p-2 text-center'; tdMedal.innerText = (r[5]||''); tr.appendChild(tdRank); tr.appendChild(tdName); tr.appendChild(tdAvg); tr.appendChild(tdCount); tr.appendChild(tdMedal); tbody.appendChild(tr); }); table.appendChild(tbody); wrap.appendChild(table); pane.appendChild(wrap); content.appendChild(pane); }); if(types.length>0) activateTab(0); }
function activateTab(i){ const header=document.getElementById('tabsHeader'); const buttons=header.querySelectorAll('button'); buttons.forEach((b,idx)=>{ if(idx===i){ b.classList.add('tab-active'); b.classList.remove('border'); } else { b.classList.remove('tab-active'); b.classList.add('border'); } }); const panes=document.querySelectorAll('.tab-pane'); panes.forEach((p,idx)=>{ if(idx===i) p.classList.remove('hidden'); else p.classList.add('hidden'); }); }
document.addEventListener('DOMContentLoaded', function(){ const u=document.getElementById('user'); if(u) u.focus(); });
</script>

</body>
</html>
